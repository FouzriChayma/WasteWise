{% extends 'baseBack.html.twig' %}


{% block content %}
<!-- Add this in the head section of your HTML file -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">my missions</h1>
    
</div>

<div class="row mb-3">
    <div class="col-md-4">
        <form action="#" method="GET" class="input-group">
            <input type="text" name="search" class="form-control" placeholder="Search...">
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>

   
<div class="d-flex justify-content-end">
        <a class="btn app-btn-secondary" href="">
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-download me-1" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                <path fill-rule="evenodd" d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
            </svg>
            Export PDF
        </a>
    </div>
</div>


<div class="table-responsive">
      <table class="table app-table-hover text-left">
                                        <thead>
                                            <tr>
                                                
                                                <th class="cell">Start Date</th>
                                                <th class="cell">End Date</th>
                                                <th class="cell">Location</th>
                                                <th class="cell">Waste Type</th>
                                                <th class="cell">Status</th>
                                                <th class="cell">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for mission in missions %}
                                                <tr>
                                                    
                                                    
                <td>{{ mission.startDate ? mission.startDate|date('Y-m-d H:i:s') : '' }}</td>
                <td>{{ mission.endDate ? mission.endDate|date('Y-m-d H:i:s') : '' }}</td>
                <td>{{ mission.location }}</td>
                <td>{{ mission.typeD }}</td>
                {% if mission.status=="completed" %}
                <td><span class="badge bg-success">{{ mission.status }}</span></td>
                {%elseif mission.status=="ongoing" %}
                <td><span class="badge bg-warning">{{ mission.status }}</span></td>
				{% endif %}
                {% if mission.status=="Undone" %}
                <td><span class="badge bg-danger">{{ mission.status }}</span></td>
                {% endif %}
                
                <td>
                   {% if mission.status!="completed" %} 
                    <a onclick="startTimer(event, '{{ mission.startDate|date('Y-m-d H:i:s') }}', '{{ mission.endDate|date('Y-m-d H:i:s') }}')" href="{{ path('start_mission', {'id': mission.getIdMission()}) }}" class="btn app-btn-primary">Start Mission</a>
                     <a href="{{ path('app_driver_validate', {'id': mission.getIdMission()}) }}" onclick="return alert('Your mission is completed!!');" class="btn app-btn-primary">Complete Mission</a>

                     <div id="time"></div>
                     {% endif %}
                </td>
              
<script>
function startTimer(event, startDate, endDate) {
  event.preventDefault(); // Prevent the default action
  console.log('startTimer() called');
  
  var display = document.querySelector('#time');
  var startTimestamp = new Date(startDate).getTime();
  var endTimestamp = new Date(endDate).getTime();
  
  // Calculate the difference between end date and start date in seconds
  var timer = Math.floor((endTimestamp - startTimestamp) / 1000);
  
  setInterval(function () {
    console.log('setInterval() called');
    var minutes = Math.floor(timer / 60);
    var seconds = timer % 60;

    minutes = minutes < 10 ? "0" + minutes : minutes;
    seconds = seconds < 10 ? "0" + seconds : seconds;

    display.textContent = minutes + ":" + seconds;

    if (--timer === (15 * 60)) { // Adjusted this condition to check for exactly 15 mins remaining
      // Show alert to driver
      alert("15 minutes left! Hurry up!");
    }
    
    if (timer < 0) {
      timer = 0;
      display.textContent = "00:00";
      // Redirect to complete mission page
      window.location.href = event.target.href; // Use the href from the event target
    }
    
  }, 1000);
}


</script>

                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
</div>
<style>
    /* Pagination styling */
    .pagination {
        display: flex;
        justify-content: center;
        list-style: none;
        padding: 0;
        border: none;
    }

    .pagination li {
        margin: 0 5px;
    }

    .pagination a {
        color: #555;
        text-decoration: none;
        padding: 5px 10px;
        border-radius: 5px;
        transition: background-color 0.3s ease;
        border: none;
    }

    .pagination a:hover {
        background-color: #f0f0f0;
    }

    .pagination .active a {
        background-color: #D4EDDA;
        color: #fff;
    }

    .pagination .disabled a {
        pointer-events: none;
        opacity: 0.6;
    }
</style>





{% endblock %}